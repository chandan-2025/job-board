
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Community Job Board</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f9f9f9;
    }

    header {
      background-color: #1976d2;
      color: white;
      padding: 1rem;
      text-align: center;
    }

    h1 {
      margin: 0;
      font-size: 1.8rem;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 20px;
      overflow-x: auto;
    }

    .filter-group {
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      justify-content: center;
      gap: 12px;
      margin-bottom: 25px;
      align-items: center;
      min-width: 320px;
    }

    .filter-group select,
    .filter-group input {
      flex: 1 1 160px;
      padding: 10px 12px;
      font-size: 16px;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      min-width: 140px;
      max-width: 250px;
    }

    .filter-group button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #1976d2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      flex-shrink: 0;
      transition: background-color 0.3s ease;
      white-space: nowrap;
    }

    .filter-group button:hover {
      background-color: #155a9c;
    }

    #resultsContainer {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      overflow-x: auto;
    }

    .result-item {
      border-bottom: 1px solid #eee;
      padding: 10px 0;
    }

    .result-item:last-child {
      border-bottom: none;
    }

    @media (max-width: 768px) {
      .filter-group {
        flex-wrap: wrap;
        justify-content: flex-start;
      }

      .filter-group select,
      .filter-group input,
      .filter-group button {
        flex: 1 1 100%;
        max-width: 100%;
      }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

</head>
<body>

  <header>
    <h1>Community Job Board</h1>
  </header>

  <div class="container">

    <div class="filter-group" id="filterGroup">
      <select id="roleFilter">
        <option value="All">All Roles</option>
        <option value="Job Seeker">Job Seeker</option>
        <option value="Referrer">Referrer</option>
      </select>

      <input type="text" id="locationFilter" placeholder="Location" />
      <input type="text" id="experienceFilter" placeholder="Experience (e.g., 2 years)" />
      <input type="text" id="companyFilter" placeholder="Company Name" />

      <button onclick="applyFilters()">Search</button>
    </div>

    <div id="resultsContainer"></div>

  </div>


<script>
  const CSV_URL = 'https://cors-anywhere.herokuapp.com/https://docs.google.com/spreadsheets/d/e/2PACX-1vS47IVX2PkhWMfZO57GjftGkUJSAX1pBMxJ5FUou4RY86T3cfpksGzD9hICU6R_VIYIPgeOu66g-fXS/pub?output=csv';

  function applyFilters() {
    const role = document.getElementById("roleFilter").value.trim().toLowerCase();
    const location = document.getElementById("locationFilter").value.trim().toLowerCase();
    const experience = document.getElementById("experienceFilter").value.trim();
    const company = document.getElementById("companyFilter").value.trim().toLowerCase();

    // Validate experience (must be a number if provided)
    if (experience && !/^\d+$/.test(experience)) {
      alert("Experience must be a valid number.");
      return;
    }

    // Hide the filter group while fetching data
    document.getElementById("filterGroup").style.display = "none";
    document.getElementById("resultsContainer").innerHTML = "Loading...";  // Show loading message

    fetch(CSV_URL)
      .then(response => response.text())
      .then(text => {
        const rows = text.trim().split('\n').map(row => row.split(','));
        const headers = rows[0].map(h => h.trim().toLowerCase());  // Normalize headers to lowercase
        const data = rows.slice(1);  // Get data excluding the header row

        console.log("Fetched Data:", data);  // Log the fetched data to check format
        console.log("Headers:", headers);    // Log the headers for debugging

        let filteredData = [];

        // Filter the data based on applied filters
        filteredData = data.filter(row => {
          const entry = {};
          headers.forEach((h, i) => entry[h] = row[i]?.trim().toLowerCase() || "");

          console.log("Checking row:", entry);  // Log each row to inspect data

          // Match based on the role, location, experience, and company
          const matchesRole = role === "" || entry.role?.includes(role);
          const matchesLocation = location === "" || entry.location?.includes(location);
          const matchesExperience = experience === "" || entry.experience?.includes(experience);
          const matchesCompany = company === "" || entry.company?.includes(company);

          // Return true if any filter is matched
          return matchesRole || matchesLocation || matchesExperience || matchesCompany;
        });

        console.log("Filtered Data:", filteredData);  // Log the filtered data for debugging

        // Display results
        displayResults(filteredData, headers);
      })
      .catch(err => {
        console.error("Error fetching CSV:", err);
        document.getElementById("resultsContainer").innerHTML = "‚ùå Failed to load data. Try again.";
      });
  }

  function displayResults(data, headers) {
    const resultsContainer = document.getElementById("resultsContainer");
    let html = "<h3>Filtered Results</h3>";

    if (data.length === 0) {
      html += "<p>No matching results found.</p>";
    } else {
      data.forEach(row => {
        html += "<div class='result-item'>";

        // Display fields for Job Seekers (if Role is Referrer)
        if (document.getElementById("roleFilter").value.toLowerCase() === "referrer") {
          html += `<p><strong>Name:</strong> ${row[headers.indexOf('name')]}</p>`;
          html += `<p><strong>Job Title:</strong> ${row[headers.indexOf('job title')]}</p>`;
          html += `<p><strong>Skills:</strong> ${row[headers.indexOf('skills')]}</p>`;
          html += `<p><strong>Experience:</strong> ${row[headers.indexOf('experience')]}</p>`;
          html += `<p><strong>Preferred Location:</strong> ${row[headers.indexOf('preferred location')]}</p>`;
        }

        // Display fields for Referrers (if Role is Job Seeker)
        else if (document.getElementById("roleFilter").value.toLowerCase() === "job seeker") {
          html += `<p><strong>Referrer's Name:</strong> ${row[headers.indexOf('referrer name')]}</p>`;
          html += `<p><strong>Company Name:</strong> ${row[headers.indexOf('company name')]}</p>`;
          html += `<p><strong>Job Title:</strong> ${row[headers.indexOf('job title')]}</p>`;
          html += `<p><strong>Referral Link:</strong> ${row[headers.indexOf('referral link')]}</p>`;
          html += `<p><strong>Job Description:</strong> ${row[headers.indexOf('job description')]}</p>`;
          html += `<p><strong>Required Skills:</strong> ${row[headers.indexOf('required skills')]}</p>`;
          html += `<p><strong>Location:</strong> ${row[headers.indexOf('location')]}</p>`;
        }

        html += "</div>";
      });
    }

    html += `<button onclick="goBackToFilters()" style="margin-top:20px; padding:10px 16px; font-size:16px; background:#555; color:white; border:none; border-radius:4px; cursor:pointer;">Back to Filters</button>`;
    resultsContainer.innerHTML = html;
  }

  function goBackToFilters() {
    document.getElementById("filterGroup").style.display = "flex";
    document.getElementById("roleFilter").value = "";
    document.getElementById("locationFilter").value = "";
    document.getElementById("experienceFilter").value = "";
    document.getElementById("companyFilter").value = "";
    document.getElementById("resultsContainer").innerHTML = "";
  }
</script>


</body>
</html>
